#!/usr/bin/awk -f

#set FS (field seperator) to ' ' and '-'?
#TODO: place max_degree at beginning, get Year (define year at beginning of file?), verify integrity of data file.

BEGIN {
    print "/* AUTOMATICALLY GENERATED BY mag_data, DO NOT EDIT, edit mag_data instead */";
    print "#ifndef data_WMM_h_";
    print "#define data_WMM_h_";
    print "struct spherical_harmonic_coefficient{";
    print "    double g,h;";
    print "};";
    print "#define YEAR 2012.5";
#somehow incorporate __DATE__?
    print "#define EPOCH 2010";
#replace 13 with max Degree
    print "static const struct spherical_harmonic_coefficient magnetic_coefficients[][13] = {";
    degree = 0;
    order  = 0;
}


(degree == $1) && (order == $2) {
    if(degree == 0 || order == 0)
        print "\t{";

    if(degree == order)
    {
        print "\t\t{ " $3 " + " $5 " * (YEAR - EPOCH), " $4 " + " $6 " * (YEAR - EPOCH)}";
        print "\t},";
        ++degree;
	order = 0;
    }
    else
    {
        print "\t\t{ " $3 " + " $5 " * (YEAR - EPOCH), " $4 " + " $6 " * (YEAR - EPOCH)},";
	++order;
    }

}

END {
    print "};";
#place max_degree at beginning of .h?
    print "static const int MAX_DEGREE = " degree - 1 ";";
    print "#undef YEAR";
    print "#undef EPOCH";
    print "#endif /* data_WMM_h_ */";
}
